---
import Layout from "@/layouts/Layout.astro";
import DeckHubView from "@/components/decks/DeckHubView";

export const prerender = false;

const user = Astro.locals.user;
if (!user || !user.id) {
  return Astro.redirect(`/auth/login?redirect=${encodeURIComponent("/decks")}`);
}

const url = new URL(Astro.request.url);
const deckIdParam = url.searchParams.get("deck");
const autoSelectQuery = url.searchParams.get("auto-select") === "true";
const shouldAutoSelect = autoSelectQuery || !deckIdParam;
---

<Layout title="Moje talie â€” LinguaPairs">
  <main class="min-h-screen bg-background">
    <div class="mx-auto w-full max-w-5xl px-4 py-10">
      <DeckHubView initialDeckId={deckIdParam ?? null} autoSelectLast={shouldAutoSelect} client:load />
    </div>
  </main>
</Layout>

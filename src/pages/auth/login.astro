---
/**
 * Login Page
 *
 * User login with email and password
 * Supports redirect parameter for post-login navigation
 */

import AuthLayout from "@/layouts/AuthLayout.astro";
import LoginForm from "@/components/auth/LoginForm";

// Get redirect parameter from URL (only allow relative paths)
const url = new URL(Astro.request.url);
const rawRedirect = url.searchParams.get("redirect") || undefined;
const redirect = rawRedirect && rawRedirect.startsWith("/") && !rawRedirect.startsWith("//") ? rawRedirect : undefined;

// SSR-only
export const prerender = false;

// If user already logged in, redirect away
const user = Astro.locals.user;
if (user) {
  return Astro.redirect(redirect || "/");
}
---

<AuthLayout title="Zaloguj się" description="Witaj z powrotem! Zaloguj się do swojego konta.">
  <LoginForm client:load redirect={redirect} />
</AuthLayout>
